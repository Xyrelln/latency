# Windows 操作延迟测量工具使用说明

Windows 端操作延迟测量工具，通过监听鼠标键盘得到操作时间，同时通过不断录屏截图之后将每张图像与前一张比对，得到画面出现变化的响应时间，响应时间与操作时间之差即为操作延迟。

## 配置选项说明

- 录制窗口：选择需要测量的程序窗口名即可。
- 操控方式：选择需要测量的操作方式，支持键盘按键和鼠标点击。
- 操控按键：选择需要监听的键盘按键。
- 自动操作：当程序开始录制后，自动发送一个对应的操纵按键事件。
- 快捷启动：开始录制流程的按键，按下配置的按键才会开始录屏以及操纵监听。

- 截图总数: 连续录制截图的总帧数。
- 对比阈值：图片比对的阈值，当两张图片哈希值差异大于此值时，判断画面出现变化。最大 255，默认值 20。

## 使用方法
1. 打开需要测试的游戏程序，选择进入到一个画面响应比较明显的游戏场景。
2. 在左边的配置界面配置录制窗口、需要监听的输入事件和截图总帧数等参数。
3. 点击左边开始按钮，将画面切换到游戏窗口。按下配置中配置的**快捷启动**后，屏幕录制和输入事件监控将会开始，在录制过程中进行相应的鼠标或键盘操作。
4. 如果画面帧率为 60 且配置截图总数为 300 帧，等待约 5 秒后，截图和操作事件采集完成。屏幕录制和对应操作都完成之后，界面会出现第一帧的截图画面和监控到的输入事件毫秒时间戳，在右侧界面图像上拖拽鼠标选择识别响应的图像区域，例如操作游戏人物，选择游戏画面中人物所在的矩形区域。
5. 点击界面下方的计算延迟，程序根据操作时间和截图对比出现变化的时间，相减得到操控延迟，界面上方会显示出识别出的响应时间和延迟。点击打开文件，可以打开当前展示的截图文件。
6. 可以点击切换任意一张截图，点击**计算延迟（图片X）**会使用当前展示的第X张图片，计算出相应的操作延迟。

---

## 常见问题

### 截图失败问题

- **管理员权限**运行程序。
- 双显卡机器需要设置 rscapture.exe 截图程序为集显运行，可以在 Nvidia 控制面板或 Window 系统设置 > 图形设置 > 添加 rscapture.exe > 选项设置为集显运行。

### 画面响应时间识别不准确

当游戏画面存在一些随机动效时，比如游戏场景中会有随机光影变化、游戏人物闲置不动时会自动做出某些动作，这些动画会干扰游戏响应画面的识别。
- 选择区域尽量精确，排除可能会产生干扰动画的区域。
- 适当通过调高`对比阈值`忽略一些非常小的变化。
- 通过界面查看上一张或下一张截图，人工判断出实际的响应帧截图，点击`计算延迟（图片X）`按钮计算操作延迟。
